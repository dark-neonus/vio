<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- Include sensor and system macros -->
    <xacro:include filename="sensors/camera_sensor.xacro" />
    <xacro:include filename="sensors/imu_sensor.xacro" />
    <xacro:include filename="systems/drone_systems.xacro" />

    <!-- Apply drone systems -->
    <xacro:drone_systems 
        publish_joint_states="true"
        publish_link_poses="true"
        static_update_frequency="100"
        enable_velocity_control="true"
        enable_imu_system="true" />

    <!-- Apply camera sensor to base_link (working configuration) -->
    <xacro:camera_sensor 
        parent_link="base_link"
        sensor_name="camera_sensor"
        topic_prefix="camera"
        update_rate="60"
        horizontal_fov="1.57"
        image_width="640"
        image_height="480"
        noise_stddev="0.03"
        distortion_k1="-0.15"
        distortion_k2="0.08"
        distortion_k3="-0.02" />

    <!-- Apply IMU sensor to base_link (working configuration) -->
    <xacro:imu_sensor 
        parent_link="base_link"
        sensor_name="imu_sensor"
        topic_name="imu/data"
        update_rate="200"
        frame_id="base_link"
        gyro_noise_density="0.0003394"
        gyro_random_walk="0.000038785"
        gyro_turn_on_bias_sigma="0.0087"
        accel_noise_density="0.004"
        accel_random_walk="0.006"
        accel_turn_on_bias_sigma="0.196" />

    <!-- Material properties for all links -->
    <gazebo reference="base_link">
        <material>Gazebo/Grey</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>

    <gazebo reference="camera_link">
        <material>Gazebo/White</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>

    <gazebo reference="imu_link">
        <material>Gazebo/Blue</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>

    <gazebo reference="front_right_prop">
        <material>Gazebo/Orange</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>
    <gazebo reference="front_left_prop">
        <material>Gazebo/Orange</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>
    <gazebo reference="rear_left_prop">
        <material>Gazebo/Orange</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>
    <gazebo reference="rear_right_prop">
        <material>Gazebo/Orange</material>
        <mu1>0.2</mu1>
        <mu2>0.2</mu2>
        <self_collide>0</self_collide>
    </gazebo>

</robot>